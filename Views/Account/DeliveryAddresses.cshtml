@model IEnumerable<JollibeeClone.Models.UserAddress>
@{
    ViewData["Title"] = "Địa chỉ giao hàng";
}

@section Styles {
    <link rel="stylesheet" href="~/css/delivery-address.css" asp-append-version="true" />
}

<!-- Account Management Section -->
<div class="account-management-container">
    <div class="container-fluid px-4 py-5">
        <div class="row">
            <!-- Sidebar Menu -->
            <div class="col-lg-3 col-md-4 mb-4">
                <div class="account-sidebar">
                    <div class="sidebar-header">
                        <h5 class="sidebar-title">TÀI KHOẢN CỦA TÔI</h5>
                    </div>
                    <div class="sidebar-menu">
                        <a href="@Url.Action("Profile", "Account")" class="sidebar-item">
                            <span class="sidebar-text">QUẢN LÝ TÀI KHOẢN</span>
                        </a>
                        <a href="#" class="sidebar-item">
                            <span class="sidebar-text">ĐƠN HÀNG CỦA TÔI</span>
                        </a>
                        <a href="@Url.Action("DeliveryAddresses", "Account")" class="sidebar-item active">
                            <span class="sidebar-text">ĐỊA CHỈ GIAO HÀNG</span>
                        </a>
                        <a href="@Url.Action("Promotions", "Account")" class="sidebar-item">
                            <span class="sidebar-text">DANH SÁCH ƯU ĐÃI</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-9 col-md-8">
                <div class="delivery-address-content">
                    <!-- Page Header -->
                    <div class="content-header">
                        <h4 class="content-title" style="color: #e31937;">ĐỊA CHỈ GIAO HÀNG</h4>
                    </div>

                    <!-- Display Messages -->
                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="fas fa-check-circle me-2"></i>@TempData["SuccessMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="fas fa-exclamation-circle me-2"></i>@TempData["ErrorMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    <!-- Default Address Section -->
                    @{
                        var defaultAddress = Model.FirstOrDefault(a => a.IsDefault);
                    }
                    @if (defaultAddress != null)
                    {
                        <div class="address-section">
                            <div class="section-header">
                                <h5 class="section-title">ĐỊA CHỈ MẶC ĐỊNH</h5>
                            </div>
                            <div class="address-card default-address">
                                <div class="address-info">
                                    <div class="address-name">@defaultAddress.FullName</div>
                                    <div class="address-details">
                                        <div class="address-text">
                                            Tại @(!string.IsNullOrEmpty(defaultAddress.Address) ? defaultAddress.Address : "Chưa cập nhật địa chỉ chi tiết")
                                        </div>
                                        <div class="address-phone">T: @defaultAddress.PhoneNumber</div>
                                        @if (!string.IsNullOrEmpty(defaultAddress.Note))
                                        {
                                            <div class="address-note">
                                                <i class="fas fa-sticky-note me-1"></i>
                                                @defaultAddress.Note
                                            </div>
                                        }
                                    </div>
                                </div>
                                <div class="address-actions">
                                    <a href="@Url.Action("EditAddress", "Account", new { id = defaultAddress.AddressID })" 
                                       class="btn btn-link text-primary action-link">
                                        Chỉnh sửa
                                    </a>
                                </div>
                            </div>
                        </div>
                    }

                    <!-- Other Addresses Section -->
                    @{
                        var otherAddresses = Model.Where(a => !a.IsDefault).ToList();
                    }
                    @if (otherAddresses.Any())
                    {
                        <div class="address-section">
                            <div class="section-header">
                                <h5 class="section-title">ĐỊA CHỈ BỔ SUNG</h5>
                            </div>
                            @foreach (var address in otherAddresses)
                            {
                                <div class="address-card">
                                    <div class="address-info">
                                        <div class="address-name">@address.FullName</div>
                                        <div class="address-details">
                                            <div class="address-text">
                                                Tại @(!string.IsNullOrEmpty(address.Address) ? address.Address : "Chưa cập nhật địa chỉ chi tiết")
                                            </div>
                                            <div class="address-phone">T: @address.PhoneNumber</div>
                                            @if (!string.IsNullOrEmpty(address.Note))
                                            {
                                                <div class="address-note">
                                                    <i class="fas fa-sticky-note me-1"></i>
                                                    @address.Note
                                                </div>
                                            }
                                        </div>
                                    </div>
                                    <div class="address-actions">
                                        <a href="@Url.Action("EditAddress", "Account", new { id = address.AddressID })" 
                                           class="btn btn-link text-primary action-link">
                                            Chỉnh sửa
                                        </a>
                                        <form asp-action="SetDefaultAddress" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@address.AddressID" />
                                            <button type="submit" class="btn btn-link text-success action-link"
                                                    onclick="return confirm('Bạn có muốn đặt làm địa chỉ mặc định?')">
                                                Đặt mặc định
                                            </button>
                                        </form>
                                        <form asp-action="DeleteAddress" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@address.AddressID" />
                                            <button type="submit" class="btn btn-link text-danger action-link"
                                                    onclick="return confirm('Bạn có chắc chắn muốn xóa địa chỉ này?')">
                                                Xóa
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            }
                        </div>
                    }

                    <!-- No Address Message -->
                    @if (!Model.Any())
                    {
                        <div class="no-address-section">
                            <div class="empty-state">
                                <i class="fas fa-map-marker-alt empty-icon"></i>
                                <p class="empty-message">Bạn không có mục địa chỉ nào khác trong sổ địa chỉ của mình.</p>
                            </div>
                        </div>
                    }

                    <!-- Add New Address Button -->
                    <div class="add-address-section">
                        <a href="@Url.Action("EditAddress", "Account")" class="btn btn-primary btn-add-address">
                            <i class="fas fa-plus me-2"></i>THÊM ĐỊA CHỈ MỚI
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
} 