@model JollibeeClone.Models.User

@{
    ViewData["Title"] = "Chi tiết người dùng";
}

@section Styles {
    <link rel="stylesheet" href="~/css/user-admin.css" />
}

<div class="user-management">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="page-title">
                <i class="fas fa-user text-jollibee-red me-2"></i>
                Chi tiết người dùng
            </h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="@Url.Action("Index")">
                            <i class="fas fa-users me-1"></i>
                            Quản lý người dùng
                        </a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">Chi tiết</li>
                </ol>
            </nav>
        </div>
        <div class="header-actions">
            <a href="@Url.Action("Edit", new { id = Model.UserID })" class="btn btn-warning me-2">
                <i class="fas fa-edit me-2"></i>
                Chỉnh sửa
            </a>
            <a href="@Url.Action("Index")" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-2"></i>
                Quay lại
            </a>
        </div>
    </div>

    <!-- Hiển thị thông báo -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show">
            <i class="fas fa-check-circle me-2"></i>
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show">
            <i class="fas fa-exclamation-circle me-2"></i>
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="row">
        <!-- Thông tin chính -->
        <div class="col-md-8">
            <div class="user-detail-card">
                <div class="row">
                    <div class="col-md-4 text-center">
                        <div class="user-detail-avatar">
                            @Model.FullName.Substring(0, 1)
                        </div>
                        <span class="badge status-badge @(Model.IsActive ? "status-active" : "status-inactive") fs-6">
                            @(Model.IsActive ? "Đang hoạt động" : "Đã vô hiệu hóa")
                        </span>
                    </div>
                    <div class="col-md-8">
                        <h3 class="mb-3">@Model.FullName</h3>
                        
                        <div class="detail-info-item">
                            <div class="detail-label">
                                <i class="fas fa-id-card me-2"></i>
                                ID người dùng
                            </div>
                            <div class="detail-value">#@Model.UserID</div>
                        </div>

                        <div class="detail-info-item">
                            <div class="detail-label">
                                <i class="fas fa-envelope me-2"></i>
                                Email
                            </div>
                            <div class="detail-value">
                                <a href="mailto:@Model.Email" class="text-decoration-none">@Model.Email</a>
                            </div>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.PhoneNumber))
                        {
                            <div class="detail-info-item">
                                <div class="detail-label">
                                    <i class="fas fa-phone me-2"></i>
                                    Số điện thoại
                                </div>
                                <div class="detail-value">
                                    <a href="tel:@Model.PhoneNumber" class="text-decoration-none">@Model.PhoneNumber</a>
                                </div>
                            </div>
                        }

                        <div class="detail-info-item">
                            <div class="detail-label">
                                <i class="fas fa-toggle-on me-2"></i>
                                Trạng thái tài khoản
                            </div>
                            <div class="detail-value">
                                @if (Model.IsActive)
                                {
                                    <span class="text-success">
                                        <i class="fas fa-check-circle me-1"></i>
                                        Đang hoạt động
                                    </span>
                                }
                                else
                                {
                                    <span class="text-danger">
                                        <i class="fas fa-times-circle me-1"></i>
                                        Đã vô hiệu hóa
                                    </span>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Thống kê -->
        <div class="col-md-4">
            <div class="row">
                <div class="col-12 mb-3">
                    <div class="stats-card">
                        <div class="stats-icon" style="background: linear-gradient(135deg, #28a745, #20c997);">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stats-number">@ViewBag.OrderCount</div>
                        <div class="stats-label">Tổng đơn hàng</div>
                    </div>
                </div>
                
                <div class="col-12 mb-3">
                    <div class="stats-card">
                        <div class="stats-icon" style="background: linear-gradient(135deg, var(--jollibee-red), #c41e3a);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stats-number">@ViewBag.ActiveOrderCount</div>
                        <div class="stats-label">Đơn hàng đang xử lý</div>
                    </div>
                </div>

                <div class="col-12 mb-3">
                    <div class="stats-card">
                        <div class="stats-icon" style="background: linear-gradient(135deg, #17a2b8, #138496);">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="stats-number">@Model.UserAddresses.Count</div>
                        <div class="stats-label">Địa chỉ đã lưu</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lịch sử đơn hàng -->
    @if (Model.Orders.Any())
    {
        <div class="user-detail-card">
            <h4 class="mb-3">
                <i class="fas fa-history me-2"></i>
                Lịch sử đơn hàng gần đây
            </h4>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Mã đơn hàng</th>
                            <th>Ngày đặt</th>
                            <th>Tổng tiền</th>
                            <th>Trạng thái</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model.Orders.OrderByDescending(o => o.OrderDate).Take(5))
                        {
                            <tr>
                                <td>
                                    <strong>@order.OrderCode</strong>
                                </td>
                                <td>@order.OrderDate.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>
                                    <strong class="text-success">@order.TotalAmount.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))</strong>
                                </td>
                                <td>
                                    @switch (order.OrderStatusID)
                                    {
                                        case 1:
                                            <span class="badge bg-warning">Chờ xử lý</span>
                                            break;
                                        case 2:
                                            <span class="badge bg-info">Đang chuẩn bị</span>
                                            break;
                                        case 3:
                                            <span class="badge bg-success">Hoàn thành</span>
                                            break;
                                        case 4:
                                            <span class="badge bg-danger">Đã hủy</span>
                                            break;
                                        default:
                                            <span class="badge bg-secondary">Không xác định</span>
                                            break;
                                    }
                                </td>
                                <td>
                                    <a href="#" class="btn btn-sm btn-outline-jollibee" title="Xem chi tiết đơn hàng">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            @if (Model.Orders.Count > 5)
            {
                <div class="text-center mt-3">
                    <a href="#" class="btn btn-outline-jollibee">
                        <i class="fas fa-plus me-2"></i>
                        Xem tất cả @Model.Orders.Count đơn hàng
                    </a>
                </div>
            }
        </div>
    }
    else
    {
        <div class="user-detail-card text-center">
            <i class="fas fa-shopping-cart text-muted" style="font-size: 3rem;"></i>
            <h5 class="mt-3 text-muted">Chưa có đơn hàng nào</h5>
            <p class="text-muted">Người dùng này chưa thực hiện đơn hàng nào.</p>
        </div>
    }

    <!-- Địa chỉ đã lưu -->
    @if (Model.UserAddresses.Any())
    {
        <div class="user-detail-card">
            <h4 class="mb-3">
                <i class="fas fa-map-marker-alt me-2"></i>
                Địa chỉ đã lưu
            </h4>
            <div class="row">
                @foreach (var address in Model.UserAddresses.Take(3))
                {
                    <div class="col-md-4 mb-3">
                        <div class="card border">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i class="fas fa-home me-1"></i>
                                    Địa chỉ #@address.AddressID
                                </h6>
                                <p class="card-text small text-muted">
                                    <!-- Hiá»ƒn thá»‹ thÃ´ng tin Ä‘á»‹a chá»‰ náº¿u cÃ³ trong model -->
                                    <i class="fas fa-map-pin me-1"></i>
                                    Địa chỉ đã lưu
                                </p>
                            </div>
                        </div>
                    </div>
                }
            </div>
            @if (Model.UserAddresses.Count > 3)
            {
                <div class="text-center">
                    <a href="#" class="btn btn-outline-jollibee">
                        <i class="fas fa-plus me-2"></i>
                        Xem tất cả @Model.UserAddresses.Count địa chỉ
                    </a>
                </div>
            }
        </div>
    }

    <!-- Hành động quản lý -->
    <div class="user-detail-card">
        <h4 class="mb-3">
            <i class="fas fa-cogs me-2"></i>
            HÃ nh Ä‘á»™ng quáº£n lÃ½
        </h4>
        <div class="row">
            <div class="col-md-6">
                <div class="d-grid gap-2">
                    <a href="@Url.Action("Edit", new { id = Model.UserID })" class="btn btn-warning">
                        <i class="fas fa-edit me-2"></i>
                        Chá»‰nh sá»­a thÃ´ng tin
                    </a>
                    @if (Model.IsActive)
                    {
                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deactivateModal">
                            <i class="fas fa-ban me-2"></i>
                            VÃ´ hiá»‡u hÃ³a tÃ i khoáº£n
                        </button>
                    }
                    else
                    {
                        <form asp-action="Edit" method="post" class="d-inline">
                            <input type="hidden" name="UserID" value="@Model.UserID" />
                            <input type="hidden" name="FullName" value="@Model.FullName" />
                            <input type="hidden" name="Email" value="@Model.Email" />
                            <input type="hidden" name="PhoneNumber" value="@Model.PhoneNumber" />
                            <input type="hidden" name="IsActive" value="true" />
                            <button type="submit" class="btn btn-success w-100">
                                <i class="fas fa-check me-2"></i>
                                KÃ­ch hoáº¡t tÃ i khoáº£n
                            </button>
                        </form>
                    }
                </div>
            </div>
            <div class="col-md-6">
                <div class="d-grid gap-2">
                    <a href="mailto:@Model.Email" class="btn btn-info">
                        <i class="fas fa-envelope me-2"></i>
                        Gá»­i email
                    </a>
                    @if (!string.IsNullOrEmpty(Model.PhoneNumber))
                    {
                        <a href="tel:@Model.PhoneNumber" class="btn btn-success">
                            <i class="fas fa-phone me-2"></i>
                            Gá»i Ä‘iá»‡n thoáº¡i
                        </a>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal xÃ¡c nháº­n vÃ´ hiá»‡u hÃ³a -->
<div class="modal fade" id="deactivateModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                    XÃ¡c nháº­n vÃ´ hiá»‡u hÃ³a
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n vÃ´ hiá»‡u hÃ³a tÃ i khoáº£n cá»§a <strong>@Model.FullName</strong>?</p>
                <p class="text-muted small">
                    <i class="fas fa-info-circle me-1"></i>
                    TÃ i khoáº£n sáº½ khÃ´ng thá»ƒ Ä‘Äƒng nháº­p nhÆ°ng dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c giá»¯ láº¡i.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Há»§y</button>
                <form asp-action="Edit" method="post" class="d-inline">
                    <input type="hidden" name="UserID" value="@Model.UserID" />
                    <input type="hidden" name="FullName" value="@Model.FullName" />
                    <input type="hidden" name="Email" value="@Model.Email" />
                    <input type="hidden" name="PhoneNumber" value="@Model.PhoneNumber" />
                    <input type="hidden" name="IsActive" value="false" />
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-ban me-2"></i>
                        VÃ´ hiá»‡u hÃ³a
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Auto-dismiss alerts after 5 seconds
            setTimeout(function() {
                $('.alert').alert('close');
            }, 5000);
        });
    </script>
} 

